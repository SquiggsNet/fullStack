apiVersion: skaffold/v1
kind: Config
build:
  tagPolicy:  
    sha256: {}
  artifacts:
    - image: gcr.io/thesquiggsnet/sn-user-server
      context: sn-user-server
      sync:
        manual:
          - src: "sn-user-server/dist/**/*.js"
            dest: sn-user-server
            strip: "sn-user-server/dist/"
      docker:
        dockerfile: Dockerfile
    - image: gcr.io/thesquiggsnet/sn-app-web
      context: sn-app-web
      sync:
        manual:
          - src: "sn-app-web/.next/**/*.js"
            dest: sn-app-web
            strip: "sn-app-web/.next/"
      docker:
        dockerfile: Dockerfile
deploy:
  kubectl:
    manifests:
      - k8s/postgres/postgres-persistent-volume-claim.yaml
      - k8s/postgres/postgres-configmap.yaml
      - k8s/postgres/postgres-secret.yaml
      - k8s/postgres/postgres-deployment.yaml
      # - k8s/postgres/postgres-cron-job.yaml
      - k8s/redis/redis-configmap.yaml
      - k8s/redis/redis-secret.yaml
      - k8s/redis/redis-deployment.yaml
      - k8s/sn-user-server/sn-user-server-configmap.yaml
      - k8s/sn-user-server/sn-user-server-deployment.yaml
      - k8s/sn-user-server/sn-user-server-ingress.yaml
      - k8s/sn-app-web/sn-app-web-configmap.yaml
      - k8s/sn-app-web/sn-app-web-deployment.yaml
      - k8s/sn-app-web/sn-app-web-ingress.yaml
      # - k8s/sn-app-secret.yaml
profiles:
- name: gcb
  build:
    googleCloudBuild:
      projectId: thesquiggsnet